#!/usr/bin/env sh

# i3blocks module for pacman upgrades.
# Displays number of upgradeable packages.
upg_sys() {
	printf "Beginning upgrade.\\n"
	
	sudo pacman -Syu && yay -Syu
	checkup && pkill -SIGRTMIN+9 i3blocks
	
	printf "\\nUpgrade complete.\\nPress <Enter> to exit window.\\n\\n"
	read -r
}

case $BLOCK_BUTTON in
	#1) $TERMINAL -e popupgrade ;;
	1) $TERMINAL -e upg_sys ;;
	2) notify-send -t 3000 "$(cat /tmp/available_updates)" ;;
	3) pgrep -x dunst >/dev/null && notify-send "Upgrade module:
ï€¡: number of upgradable packages
- Left click to upgrade packages
- Middle click to show upgradable packages" ;;
esac

local -i NUM
NUM=$( cat /tmp/available_updates | wc -l )
if [[ $NUM -ge 1 ]]; then
	echo "$NUM"
fi
