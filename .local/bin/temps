#!/bin/bash



temps() {

	message(){
		python -c 'print("-" * 30)'
		echo "${1}"
		python -c 'print("-" * 30)'
	}

	message "DRIVE TEMPS"
	for drive in $(/usr/bin/ls /dev/sd[a-z]); do
		# sudo hddtemp "${drive}" | cut -d":" -f 2,3 | tr -d "^ " | awk -F: '{print $1":\t"$2}'
		sudo hddtemp "${drive}" | awk -F: '{ gsub(/ /,""); print $2":\t"$3}'
	done

	for drive in $(/usr/bin/ls /dev/nvme[0-1]n[0-1]); do
		printf '%s:\t\t' "$drive"
		# sudo nvme smart-log /dev/nvme0n1 | grep '^temperature' | cut -d":" -f 2 | cut -d"(" -f 1
		sudo nvme smart-log /dev/nvme0n1 | grep '^temperature' | cut -d"(" -f 1 | awk -F: '{ gsub(/ /,""); print $2}'
	done

	message "GPU TEMPS"

	echo -e "$( \
				sensors | \
				grep 'amdgpu-pci-0a00' -A 5 | \
				grep 'edge' | \
				awk '{gsub("+",""); gsub("°C",""); printf "RX 550 LP\t\t%d°C\n",$2}' \
				)"

	message "CPU FREQ"

	fr=( $(cat /proc/cpuinfo | grep MHz | cut -d ":" -f 2) )

	length=${#fr[@]}
	for (( j=0; j<${length}; j+=2 ));
	do
		k=$((j+1))
		# num=$(echo "echo ${fr[$j]} | awk '{print int($1)}'")
		printf "%2d: %s \t" $((j+1)) $(echo "${fr[$j]}" | awk '{print int($1)/1000"Ghz"}')
		printf "%2d: %s \n" $((j+2)) $(echo "${fr[$((j+1))]}" | awk '{printf "%2.2fGhz",int($1)/1000}')
	done

}

trap 'unset temps' INT TERM

export -f temps

watch -t -x bash -c temps
