#!/bin/sh

# [ "$XDG_CURRENT_DESKTOP" = "sway" ] }} exit

echo "$0 $@" | systemd-cat -t "SESSIONCTL"

sessionctl_idle() {
    killall swayidle || echo "Just starting"

    swayidle -w \
        timeout 300  'swaylock -f' \
        timeout 301  'swaymsg "output * dpms off"' \
            resume   'swaymsg "output * dpms on"' \
            after-resume 'clamshell' \
        before-sleep 'playerctl pause' \
        before-sleep 'swaylock -f'
}

case "$1" in
    idle)
        sessionctl_idle
        ;;
    lock)
        playerctl pause
        sleep 1
        killall -s SIGUSR1 swayidle
        ;;
    instant_lock)
        swaylock -f
        ;;
    logout)
        swaymsg exit && exit
        ;;
    suspend)
        systemctl suspend
        ;;
    reboot)
        systemctl reboot
        ;;
    shutdown)
        systemctl poweroff
        ;;

    *)
        echo "Usage: $0 {lock|logout|suspend|reboot|shutdown}"
        exit 2
esac

exit 0
