#!/bin/sh

args=$*

echo "$0 $args" | systemd-cat -t "SESSIONCTL"

sessionctl_idle() {
    /usr/bin/swayidle -w \
            timeout 295 'sessionctl lock-session' \
            timeout 300 'swaymsg "output * dpms off"' \
            timeout 600 'systemctl suspend' \
            resume  'swaymsg "output * dpms on"' \
            after-resume  'clamshell; swaymsg "output * dpms on"' \
            before-sleep 'sessionctl lock-session' \
            lock 'playerctl pause; swaylock -f' \
            unlock 'pkill swaylock -f'
}

lock_idle() {
    swayidle \
        timeout 5 'swaymsg "output * dpms off"' \
        resume 'swaymsg "output * dpms on"'
}


sway_sessionctl() {
    case "$1" in
        idle)
            sessionctl_idle
            ;;
        lock|lock-session)
            loginctl lock-session
            ;;
        lock-idle)
            lock_idle
        ;;
        logout)
            swaymsg exit && exit
            ;;
        suspend)
            systemctl suspend
            ;;
        reboot)
            systemctl reboot
            ;;
        shutdown)
            systemctl poweroff
            ;;

        *)
            echo "Usage: $0 {lock|logout|suspend|reboot|shutdown}"
            exit 2
    esac
}


case "$XDG_CURRENT_DESKTOP" in
    sway)
        sway_sessionctl "$1"
    ;;
    *)
        exit 1
    ;;
esac
